# نظام إشعارات رسائل الدعم - LeaseMate

## الميزات الجديدة المضافة

### 1. إشعارات للمستخدمين عند إرسال رسائل من الإدارة
- **النوع**: `SUPPORT_MESSAGE_TO_USER`
- **الوصف**: عندما يرسل الإدارة رسالة للمستخدم، يتم إرسال إشعار فوري
- **الموقع**: يظهر في النافبار وفي صفحة الإشعارات
- **الانتقال**: عند الضغط على الإشعار يتم الانتقال لصفحة التواصل مع الدعم

### 2. إشعارات للإدارة عند إرسال رسائل من المستخدمين
- **النوع**: `SUPPORT_MESSAGE_TO_ADMIN`
- **الوصف**: عندما يرسل المستخدم رسالة للإدارة، يتم إرسال إشعار لجميع المشرفين
- **الموقع**: يظهر في النافبار للإدارة مع عداد أحمر
- **الانتقال**: عند الضغط على الإشعار يتم الانتقال لتبويب الدعم في لوحة تحكم الإدارة

### 3. عداد الرسائل غير المقروءة
- **للإدارة**: عداد أحمر في النافبار يظهر عدد الرسائل غير المقروءة من المستخدمين
- **للمستخدمين**: عداد في صفحة التواصل مع الدعم يظهر عدد الرسائل غير المقروءة من الإدارة

### 4. تحسينات في واجهة المستخدم
- **زر الدعم في النافبار**: للإدارة مع عداد للرسائل غير المقروءة
- **إشعار في صفحة الدعم**: للمستخدمين يظهر عند وجود رسائل جديدة من الإدارة
- **فلترة الإشعارات**: إمكانية تصفية الإشعارات حسب نوع رسائل الدعم

## التحديثات التقنية

### الباك إند
1. **إضافة أنواع إشعارات جديدة** في `notification.model.js`:
   - `SUPPORT_MESSAGE_TO_USER`
   - `SUPPORT_MESSAGE_TO_ADMIN`

2. **تحديث ملف السوكت** في `socket.js`:
   - إرسال إشعارات تلقائية عند إرسال رسائل الدعم
   - إشعار جميع المشرفين عند رسالة من المستخدم
   - إشعار المستخدم عند رسالة من الإدارة

### الفرونت إند
1. **تحديث النافبار** في `Navbar.tsx`:
   - إضافة زر رسائل الدعم للإدارة مع عداد
   - عرض عدد الرسائل غير المقروءة

2. **تحديث سياق الإشعارات** في `NotificationsContext.tsx`:
   - معالجة الأنواع الجديدة من الإشعارات
   - الانتقال التلقائي للصفحات المناسبة

3. **تحديث لوحة تحكم الإدارة** في `admin/dashboard/page.tsx`:
   - عداد للرسائل غير المقروءة في تبويب الدعم
   - معالجة معامل URL للانتقال المباشر لتبويب الدعم

4. **تحديث صفحة الدعم** في `dashboard/support-chat/page.tsx`:
   - عرض إشعار للرسائل الجديدة من الإدارة

5. **تحديث صفحة الإشعارات** في `notifications/page.tsx`:
   - فلترة رسائل الدعم
   - أيقونات ونصوص مناسبة للأنواع الجديدة

## كيفية الاستخدام

### للمستخدمين (الملاك والمستأجرين)
1. عند إرسال رسالة للإدارة، سيتم إرسال إشعار لجميع المشرفين
2. عند استقبال رسالة من الإدارة، سيظهر إشعار في النافبار
3. يمكن الوصول لرسائل الدعم من القائمة المنسدلة في النافبار

### للإدارة
1. عند استقبال رسالة من المستخدم، سيظهر عداد أحمر في النافبار
2. الضغط على زر رسائل الدعم في النافبار ينقل مباشرة لتبويب الدعم
3. يمكن الوصول لجميع رسائل الدعم من لوحة التحكم

## الملفات المحدثة

### الباك إند
- `models/notification.model.js`
- `socket.js`

### الفرونت إند
- `components/Navbar.tsx`
- `contexts/NotificationsContext.tsx`
- `app/admin/dashboard/page.tsx`
- `app/dashboard/support-chat/page.tsx`
- `app/notifications/page.tsx`

## ملاحظات تقنية

1. **الأداء**: الإشعارات تُرسل عبر Socket.IO للسرعة والكفاءة
2. **الأمان**: يتم التحقق من صلاحيات المستخدم قبل إرسال الإشعارات
3. **التوافق**: النظام يعمل مع جميع أنواع المستخدمين (مالك، مستأجر، مشرف)
4. **التجربة**: واجهة مستخدم سلسة مع انتقالات تلقائية للصفحات المناسبة 